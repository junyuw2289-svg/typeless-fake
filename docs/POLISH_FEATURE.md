# AI 润色功能说明

## 📋 功能概述

在语音转文字后,AI 会对文本进行**最小化干预**的润色处理,让输出更干净,但依然保持你的说话风格。

## 🎯 设计原则

### ✅ 会做的事 (必要清理)

1. **去除填充词**
   - 中文: 嗯、啊、那个、就是、呃
   - 英文: um, uh, you know, like (作为填充词时)

2. **去除重复**
   - 口吃重复: "我我我想" → "我想"
   - 不必要的重复: "the the table" → "the table"

3. **处理自我纠正**
   - "我想去图书馆,不对,去咖啡厅" → "去咖啡厅"
   - 保留最终意图,删除改口前的内容

4. **添加标点**
   - 句号、逗号、问号
   - 首字母大写

5. **修复明显语法错误**
   - 主谓一致
   - 时态一致
   - 缺失的冠词

### ❌ 不会做的事 (保持原话)

1. **不改写句子结构**
   - 不会重新组织句子顺序
   - 不会把"我觉得"改成"依我之见"

2. **不替换词汇**
   - 保持你的用词习惯
   - 不会把口语改成书面语

3. **不添加信息**
   - 不会补充你没说的内容
   - 不会扩展简短的回答

4. **不改变风格**
   - 保持口语化/正式化程度
   - 不会把随意的聊天变成正式邮件

5. **不改技术术语**
   - 保留专业词汇
   - 保留品牌名、人名

## 🔧 使用方法

### 启用/禁用润色

润色功能**默认启用**,可以在设置中关闭:

```typescript
// 方法 1: 通过 UI 设置 (未来会添加)
Settings → Enable AI Polish → Toggle

// 方法 2: 通过配置文件
// ~/.config/typeless-fake/config.json
{
  "enablePolish": false  // 设为 false 关闭
}

// 方法 3: 通过代码 (开发模式)
// src/main/config-store.ts
defaults: {
  enablePolish: true  // 改为 false
}
```

### 查看效果

开启控制台日志,可以看到润色前后的对比:

```bash
# 启动应用时
npm start

# 控制台输出
[Transcription] Raw text: 嗯,我我觉得,那个,这个项目...
[Transcription] Polished text: 我觉得这个项目...
```

## 📊 性能指标

| 指标 | 数值 |
|------|------|
| **额外延迟** | 200-500ms |
| **额外成本** | ~$0.00015/次 |
| **成本增幅** | ~2.5% |
| **用户感知** | 几乎无感知 |

## 💡 使用建议

### 适合开启润色的场景

- ✅ 发送邮件、消息
- ✅ 写文档、笔记
- ✅ 日常对话记录
- ✅ 会议纪要

### 建议关闭润色的场景

- ❌ 需要完全逐字记录 (如采访、证词)
- ❌ 要保留所有口语特征 (如研究语言习惯)
- ❌ 网络不好导致延迟明显

## 🧪 测试示例

### 示例 1: 日常对话

**输入**:
```
"嗯,我觉得,那个,今天下午我们,嗯,去咖啡厅见面吧"
```

**润色后** (enablePolish: true):
```
"我觉得今天下午我们去咖啡厅见面吧"
```

**原始输出** (enablePolish: false):
```
"嗯,我觉得,那个,今天下午我们,嗯,去咖啡厅见面吧"
```

### 示例 2: 技术讨论

**输入**:
```
"这个 API 的,嗯,response time 需要,那个,优化一下"
```

**润色后**:
```
"这个 API 的 response time 需要优化一下"
```

**注意**: 保留了 "API" 和 "response time" 专业术语

### 示例 3: 自我纠正

**输入**:
```
"我们明天下午三点,不对,四点见面"
```

**润色后**:
```
"我们明天下午四点见面"
```

## ⚙️ 高级配置

### 调整润色强度

如果觉得润色改动太多或太少,可以调整 temperature:

```typescript
// src/main/transcription-service.ts
temperature: 0.2  // 当前值

// 更保守 (改动更少)
temperature: 0.1

// 更自然 (改动可能更多,但更流畅)
temperature: 0.3
```

### 自定义 Prompt

如果需要调整润色行为,可以修改:

```typescript
// src/main/transcription-service.ts
private getPolishPrompt(language?: string): string {
  // 修改这里的 prompt
}
```

## 🐛 故障排查

### 润色失败怎么办?

如果润色过程出错,会**自动降级到原始转录**:

```typescript
// 代码中的保护机制
try {
  const polishedText = await this.polish(rawText, language);
  return polishedText;
} catch (error) {
  console.error('[Transcription] Polish failed:', error);
  return rawText; // 降级到原始转录
}
```

### 常见问题

**Q: 润色后文本完全变了样?**
A: 检查 temperature 设置,建议降低到 0.1-0.2

**Q: 有些填充词没有被去除?**
A: 可能是模型判断这些词有实际意义,可以查看日志确认

**Q: 延迟太长?**
A: 检查网络连接,或临时关闭润色功能

**Q: 想看到原始转录?**
A: 查看控制台日志,或临时关闭润色

## 📈 未来改进

1. **UI 控制**: 在设置界面添加开关
2. **实时对比**: 显示润色前后的文本对比
3. **撤销功能**: 一键恢复原始转录
4. **上下文感知**: 根据应用类型调整润色策略
5. **个性化学习**: 学习用户的说话习惯

## 🤝 反馈

如果发现润色效果不理想,请记录:
- 原始输入 (Raw text)
- 润色输出 (Polished text)
- 期望输出 (Expected)
- 使用场景

这些反馈将帮助优化 prompt 和算法。

---

**总结**: AI 润色功能的目标是让转录结果"干净但不失真",去掉杂音但保留你的声音。
