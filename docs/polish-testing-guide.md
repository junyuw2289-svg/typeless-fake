# AI 润色功能测试指南

## 功能概述

新增的 AI 润色功能会在语音转文字后,对文本进行**最小化干预**的清理,包括:

✅ **会做的事情** (最小必要改动):
- 去除填充词 (嗯、啊、那个、um、uh)
- 去除重复词 (the the → the)
- 处理自我纠正 (保留最终意图)
- 添加标点符号
- 修复明显语法错误

❌ **不会做的事情** (保持原话风格):
- 改写句子结构
- 替换你的用词
- 添加新信息
- 改变正式程度
- 格式化为列表 (除非你明确说了列表)

## 配置选项

在设置中可以控制是否启用润色:

```typescript
settings: {
  enablePolish: true  // 默认启用,可以关闭
}
```

## 测试用例

### 测试 1: 去除填充词 (中文)

**输入语音**:
```
"嗯,我觉得这个,那个,项目的话呢,就是需要,嗯,重新设计一下"
```

**期望输出** (保持原话结构):
```
"我觉得这个项目需要重新设计一下"
```

**不应该输出** (过度改写):
```
"该项目需要重新进行设计" ❌ (改变了说话风格)
```

---

### 测试 2: 去除填充词 (英文)

**输入语音**:
```
"Um, I think, you know, we should, like, totally redesign this"
```

**期望输出**:
```
"I think we should totally redesign this"
```

**不应该输出**:
```
"We should completely redesign this" ❌ (删掉了 "I think",改了 "totally")
```

---

### 测试 3: 处理重复

**输入语音**:
```
"我我我想要去去咖啡厅见面"
```

**期望输出**:
```
"我想要去咖啡厅见面"
```

---

### 测试 4: 自我纠正

**输入语音**:
```
"我想去图书馆,不对,我们去咖啡厅吧"
```

**期望输出**:
```
"我们去咖啡厅吧"
```

---

### 测试 5: 保持有意重复 (强调)

**输入语音**:
```
"这个非常非常重要"
```

**期望输出** (保留强调):
```
"这个非常非常重要"
```

**不应该**:
```
"这个非常重要" ❌ (删掉了强调)
```

---

### 测试 6: 添加标点但不改结构

**输入语音**:
```
"今天天气很好我们去公园散步吧你觉得怎么样"
```

**期望输出** (只加标点):
```
"今天天气很好,我们去公园散步吧,你觉得怎么样?"
```

**不应该输出** (改写):
```
"由于今天天气很好,我建议我们去公园散步,你的意见如何?" ❌
```

---

### 测试 7: 修复语法但不改词汇

**输入语音**:
```
"他昨天去了超市买东西"
```

**期望输出** (无需改动,已经正确):
```
"他昨天去了超市买东西"
```

---

### 测试 8: 保持技术术语

**输入语音**:
```
"这个 API 的 response time 需要优化一下"
```

**期望输出** (保持专业术语):
```
"这个 API 的 response time 需要优化一下"
```

**不应该**:
```
"这个接口的响应时间需要优化" ❌ (改了专业术语)
```

---

### 测试 9: 保持口语化表达

**输入语音**:
```
"这个东西挺好用的,你可以试试看"
```

**期望输出** (保持口语):
```
"这个东西挺好用的,你可以试试看"
```

**不应该**:
```
"此产品使用效果良好,建议您尝试" ❌ (变得太正式)
```

---

### 测试 10: "然后" 的区分

**输入语音 A** (作为连接词,应保留):
```
"我先去买菜,然后去接孩子"
```

**期望输出**:
```
"我先去买菜,然后去接孩子"
```

**输入语音 B** (作为填充词,应删除):
```
"我觉得,然后,这个方案不太好"
```

**期望输出**:
```
"我觉得这个方案不太好"
```

---

## 对比测试:开启 vs 关闭润色

为了验证润色的价值,可以做对比测试:

### 相同语音输入

```
"嗯,我我觉得,那个,这个项目呢,就是需要,嗯,重新设计一下,你你觉得呢"
```

### 关闭润色 (enablePolish: false)

**输出**:
```
"嗯,我我觉得,那个,这个项目呢,就是需要,嗯,重新设计一下,你你觉得呢"
```
(完全原始转录)

### 开启润色 (enablePolish: true)

**输出**:
```
"我觉得这个项目需要重新设计一下,你觉得呢?"
```
(干净但保持原话风格)

---

## 性能指标

- **额外延迟**: ~200-500ms (gpt-4o-mini)
- **额外成本**: 每次约 $0.00015 (相比转录成本增加 ~2.5%)
- **用户感知**: 基本无感知 (总时长仍在 1-2 秒内)

---

## 调试技巧

### 查看日志

打开应用后,查看控制台输出:

```bash
[Transcription] Raw text: 嗯,我我觉得,那个,这个项目...
[Transcription] Polished text: 我觉得这个项目...
```

对比两行日志,可以看到润色前后的变化。

### 临时关闭润色

如果觉得润色改变太多,可以临时关闭:

```typescript
// 在设置中关闭
settings.enablePolish = false
```

或者在代码中修改默认值:

```typescript
// src/main/config-store.ts
defaults: {
  enablePolish: false  // 改为 false
}
```

---

## 优化建议

如果发现润色效果不理想:

### 1. 调整 Temperature

在 `transcription-service.ts` 中:

```typescript
temperature: 0.2  // 当前值,越低越保守
```

- 降低到 0.1: 更保守,改动更少
- 提升到 0.3-0.4: 更自然,但可能改动更多

### 2. 简化 Prompt

如果觉得 prompt 太复杂,可以简化为:

```typescript
`You are a minimal editor. Only:
1. Remove filler words: 嗯, 啊, um, uh
2. Remove stutters: "the the" → "the"
3. Add basic punctuation
DO NOT change sentence structure or word choices.`
```

### 3. 收集反馈

建议记录一些实际使用案例:
- 哪些润色效果好
- 哪些润色改变太多
- 什么场景下需要关闭润色

用这些反馈来优化 prompt。

---

## 常见问题

### Q: 润色会不会改变我说话的意思?

A: 不会。Prompt 明确要求"Preserve the speaker's original meaning and intent",只做最小必要的清理。

### Q: 如果我就是想保留 "嗯" 怎么办?

A: 可以关闭润色功能,或者在说话时说得更清楚,比如 "嗯,是的" → "是的"。

### Q: 性能会不会变慢?

A: 增加约 200-500ms,用户基本无感知。如果网络不好可能延迟更明显,可以考虑关闭润色。

### Q: 能不能看到润色前后的对比?

A: 目前在控制台日志中可以看到。如果需要,可以在 UI 中添加"查看原始转录"功能。

---

## 下一步优化方向

1. **上下文感知**: 检测当前应用,调整语气 (邮件正式/聊天随意)
2. **个性化学习**: 学习你的说话习惯,越用越准
3. **用户反馈**: 添加 "撤销润色" 按钮,恢复原始转录
4. **自定义规则**: 让用户自定义哪些词是填充词,哪些要保留

---

## 总结

新的 AI 润色功能遵循**最小化干预**原则:

- ✅ 去掉明显的填充词和重复
- ✅ 添加必要的标点
- ✅ 修复明显的语法错误
- ❌ 不改变你的说话风格
- ❌ 不改写句子结构
- ❌ 不添加新信息

**目标**: 让转录结果读起来干净,但依然是"你的话"。
